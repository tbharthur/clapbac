generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Restaurant {
  id        String   @id
  name      String
  initials  String
  color     String
  location  String?
  createdAt DateTime @default(now()) @map("created_at")
  reviews   Review[]

  @@map("restaurants")
}

model Reviewer {
  id                     String   @id
  displayName            String   @map("display_name")
  realNameInitial        String?  @map("real_name_initial")
  platforms              String[]
  handles                Json?
  avatar                 String?
  location               String?
  publicReviewCount      Int      @default(0) @map("public_review_count")
  memberSince            String?  @map("member_since")
  eliteStatus            Boolean  @default(false) @map("elite_status")
  eliteYears             String[] @map("elite_years")
  followers              Int?
  aggregateRating        Decimal  @default(0) @map("aggregate_rating") @db.Decimal(3, 1)
  totalRestaurantReviews Int      @default(0) @map("total_restaurant_reviews")
  tags                   String[]
  bio                    String?
  recentActivity         String?  @map("recent_activity")
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @default(now()) @updatedAt @map("updated_at")
  reviews                Review[]

  @@map("reviewers")
}

model Review {
  id           String     @id
  reviewerId   String     @map("reviewer_id")
  restaurantId String     @map("restaurant_id")
  rating       Int
  content      String
  date         DateTime   @db.Date
  verified     Boolean    @default(false)
  helpful      Int        @default(0)
  flags        String[]
  categories   Json?
  createdAt    DateTime   @default(now()) @map("created_at")
  reviewer     Reviewer   @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([reviewerId])
  @@index([restaurantId])
  @@index([date(sort: Desc)])
  @@map("reviews")
}

model TagType {
  tagKey String @id @map("tag_key")
  label  String
  type   String

  @@map("tag_types")
}

model FlagType {
  flagKey String @id @map("flag_key")
  label   String
  type    String

  @@map("flag_types")
}
